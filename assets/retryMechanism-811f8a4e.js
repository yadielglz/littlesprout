import{V as l}from"./index-b97ebd9a.js";import"./vendor-863865b6.js";import"./charts-3cd2c548.js";import"./utils-f957b70f.js";class m{static async delay(e){return new Promise(r=>setTimeout(r,e))}static async withRetry(e,r={}){const{maxAttempts:t=3,initialDelay:s=1e3,maxDelay:n=1e4,backoffFactor:y=2,onRetry:u,showToast:c=!0}=r;let i,o=s;for(let a=1;a<=t;a++)try{return await e()}catch(f){if(i=f,a===t)throw c&&l.error(`Operation failed after ${t} attempts. Please try again later.`),i;if(!this.isRetryableError(i))throw i;u&&u(a,i),c&&a===1&&l.loading(`Retrying... (${a}/${t})`,{id:"retry-toast",duration:o}),await this.delay(o),o=Math.min(o*y,n)}throw i}static isRetryableError(e){var n;const r=((n=e.message)==null?void 0:n.toLowerCase())||"",t=e.code||"";if(r.includes("network")||r.includes("timeout")||r.includes("connection")||t.includes("unavailable")||t.includes("deadline-exceeded")||t.includes("resource-exhausted"))return!0;const s=e.status;return s>=500||s===429?!0:!(t.includes("permission-denied")||t.includes("unauthenticated")||t.includes("not-found")||t.includes("invalid-argument"))}static createRetryableOperation(e,r){return()=>this.withRetry(e,r)}}const g=()=>({retry:(e,r)=>m.withRetry(e,r)});export{m as RetryMechanism,m as default,g as useRetry};
